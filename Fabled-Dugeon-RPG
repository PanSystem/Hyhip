local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local HttpService = game:GetService("HttpService")

local lplr = Players.LocalPlayer

-------------------------------------------------------------------------
-- STATE & VARIABLES
-------------------------------------------------------------------------
local STATE = {
    AutoDungeonEnabled = false,
    AutoFarmEnabled = false,
    AutoRetryEnabled = false,
    AutoSkillsEnabled = true,
    AutoSaveEnabled = false,
    AutoLoadConfig = false,
    IsRunning = true,
    SelectedDungeon = "Normal Dungeon",
    SelectedMap = "",
    CurrentConfigName = "Default",
}

local CFG = {
    AttackDist = 12,
    MoveSpeed = 60,
    PanicSpeed = 100,
    SearchRange = 1500,
    RetryInterval = 0.5,
    SafeSpotRadius = 12,
    SkillCooldown = 1.0,
    VerticalEscapeHeight = 40,
    AngleCheckCount = 8,
    EscapeAsLastResort = true,
    DangerKeywords = {"hitbox", "damage", "area", "burn", "lava", "cone", "skill", "atk", "projectile", "bullet", "poison", "trap", "explosion", "fire", "hazard"},
}

-- Config Presets
local CONFIG_PRESETS = {
    Default = {
        AttackDist = 12, MoveSpeed = 60, PanicSpeed = 100, SearchRange = 1500,
        SafeSpotRadius = 12, AngleCheckCount = 8, VerticalEscapeHeight = 40, SkillCooldown = 1.0
    },
    Aggressive = {
        AttackDist = 10, MoveSpeed = 80, PanicSpeed = 120, SearchRange = 2000,
        SafeSpotRadius = 10, AngleCheckCount = 8, VerticalEscapeHeight = 35, SkillCooldown = 0.8
    },
    Safe = {
        AttackDist = 15, MoveSpeed = 50, PanicSpeed = 90, SearchRange = 1200,
        SafeSpotRadius = 15, AngleCheckCount = 12, VerticalEscapeHeight = 50, SkillCooldown = 1.2
    },
    Speed = {
        AttackDist = 12, MoveSpeed = 100, PanicSpeed = 150, SearchRange = 2500,
        SafeSpotRadius = 12, AngleCheckCount = 8, VerticalEscapeHeight = 40, SkillCooldown = 0.6
    },
}

local STATS = {
    EnemiesFound = 0,
    AttacksFired = 0,
    DangersDetected = 0,
    EvasionAttempts = 0,
    SafeSpotsFound = 0,
    VerticalEscapes = 0,
    Respawns = 0,
    LastTarget = "None",
    FarmActive = false,
    Status = "Idle"
}

-- Config Folder
local ConfigFolder = "Hyper_premium"
if not isfolder(ConfigFolder) then makefolder(ConfigFolder) end

-------------------------------------------------------------------------
-- CONFIG SYSTEM
-------------------------------------------------------------------------
local function SaveConfig(name)
    local file = ConfigFolder .. "/" .. name .. ".json"
    local data = {}
    for k,v in pairs(CFG) do data[k] = v end
    data.AutoLoadConfig = STATE.AutoLoadConfig
    data.AutoSkillsEnabled = STATE.AutoSkillsEnabled
    writefile(file, HttpService:JSONEncode(data))
    print("‚úÖ Config Saved: " .. name)
    return true
end

local function LoadConfig(name)
    local file = ConfigFolder .. "/" .. name .. ".json"
    if isfile(file) then
        local content = readfile(file)
        local success, decoded = pcall(function() return HttpService:JSONDecode(content) end)
        if success and decoded then
            for k, v in pairs(decoded) do
                if CFG[k] ~= nil then CFG[k] = v end
            end
            if decoded.AutoLoadConfig ~= nil then STATE.AutoLoadConfig = decoded.AutoLoadConfig end
            if decoded.AutoSkillsEnabled ~= nil then STATE.AutoSkillsEnabled = decoded.AutoSkillsEnabled end
            print("‚úÖ Config Loaded: " .. name)
            return true
        end
    end
    return false
end

local function LoadConfigPreset(presetName)
    local preset = CONFIG_PRESETS[presetName]
    if not preset then return false end
    for key, value in pairs(preset) do
        CFG[key] = value
    end
    STATE.CurrentConfigName = presetName
    print("‚úÖ Loaded Preset:", presetName)
    return true
end

local function GetConfigList()
    local files = {}
    local success, result = pcall(function() return listfiles(ConfigFolder) end)
    if success then
        for _, file in ipairs(result) do
            local name = file:match("([^/|\\]+)%.json$")
            if name then table.insert(files, name) end
        end
    end
    return files
end

-------------------------------------------------------------------------
-- CHARACTER MANAGEMENT
-------------------------------------------------------------------------
local CachedChar = nil
local CachedRoot = nil
local CachedHum = nil
local BodyVel = nil
local BodyGyro = nil

local function UpdateCharacterCache()
    CachedChar = lplr.Character
    if CachedChar then
        CachedRoot = CachedChar:FindFirstChild("HumanoidRootPart")
        CachedHum = CachedChar:FindFirstChild("Humanoid")
        return true
    end
    return false
end

local function CreateBodyMovers()
    if not CachedRoot then return end
    
    if BodyVel then BodyVel:Destroy() end
    if BodyGyro then BodyGyro:Destroy() end
    
    BodyVel = Instance.new("BodyVelocity")
    BodyVel.MaxForce = Vector3.new(1e9, 1e9, 1e9)
    BodyVel.Velocity = Vector3.zero
    BodyVel.Parent = CachedRoot
    
    BodyGyro = Instance.new("BodyGyro")
    BodyGyro.MaxTorque = Vector3.new(1e9, 1e9, 1e9)
    BodyGyro.P = 5000
    BodyGyro.D = 500
    BodyGyro.Parent = CachedRoot
    
    print("‚úÖ Body Movers Created")
end

local function RemoveBodyMovers()
    if BodyVel then BodyVel:Destroy() BodyVel = nil end
    if BodyGyro then BodyGyro:Destroy() BodyGyro = nil end
end

-- Character Respawn Handler
lplr.CharacterAdded:Connect(function(char)
    print("üîÑ Character Respawned!")
    STATS.Respawns = STATS.Respawns + 1
    task.wait(1)
    UpdateCharacterCache()
    if STATE.AutoFarmEnabled then
        print("üü¢ Restarting Auto Farm...")
        task.wait(1)
        if CachedRoot then CreateBodyMovers() end
    end
end)

task.wait(1)
UpdateCharacterCache()

-------------------------------------------------------------------------
-- PERFORMANCE CACHE
-------------------------------------------------------------------------
local EnemyCache = {}
local DangerCache = {}
local lastCacheUpdate = 0
local CACHE_INTERVAL = 0.5

local function UpdateEnemyCache()
    local now = tick()
    if now - lastCacheUpdate < CACHE_INTERVAL then return end
    
    table.clear(EnemyCache)
    local enemies = Workspace:FindFirstChild("Enemies")
    if enemies then
        for _, enemy in ipairs(enemies:GetChildren()) do
            if enemy:IsA("Model") then
                local hum = enemy:FindFirstChild("Humanoid")
                local root = enemy:FindFirstChild("HumanoidRootPart")
                if hum and root and hum.Health > 0 then
                    table.insert(EnemyCache, {
                        Enemy = enemy,
                        Root = root,
                        Position = root.Position,
                    })
                end
            end
        end
    end
    lastCacheUpdate = now
    STATS.EnemiesFound = #EnemyCache
end

-------------------------------------------------------------------------
-- HELPER FUNCTIONS
-------------------------------------------------------------------------
local function ClickButton(button)
    if not button or not button.Visible then return false end
    pcall(function()
        if firesignal then
            firesignal(button.MouseButton1Click)
        else
            local pos = button.AbsolutePosition + (button.AbsoluteSize * 0.5)
            VirtualInputManager:SendMouseButtonEvent(pos.X, pos.Y, 0, true, game, 1)
            task.wait(0.05)
            VirtualInputManager:SendMouseButtonEvent(pos.X, pos.Y, 0, false, game, 1)
        end
    end)
    task.wait(0.2)
    return true
end

local function PressKey(key)
    VirtualInputManager:SendKeyEvent(true, key, false, game)
    task.wait(0.05)
    VirtualInputManager:SendKeyEvent(false, key, false, game)
end

local function AttemptAttack()
    local SwingRemote = ReplicatedStorage:FindFirstChild("Swing") or ReplicatedStorage:FindFirstChild("Attack")
    if SwingRemote then 
        pcall(function() SwingRemote:FireServer() end)
    end
    VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 1)
    task.wait(0.05)
    VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 1)
end

-------------------------------------------------------------------------
-- DANGER DETECTION & EVASION
-------------------------------------------------------------------------
local Overlap = OverlapParams.new()
Overlap.FilterType = Enum.RaycastFilterType.Exclude
Overlap.MaxParts = 15

local function IsDangerPart(part)
    if not part then return false end
    local cached = DangerCache[part]
    if cached ~= nil then return cached end
    
    local name = part.Name:lower()
    local isDanger = false
    for _, keyword in ipairs(CFG.DangerKeywords) do
        if string.find(name, keyword, 1, true) then
            isDanger = true
            break
        end
    end
    DangerCache[part] = isDanger
    return isDanger
end

local function IsPositionDangerous(position)
    Overlap.FilterDescendantsInstances = {CachedChar}
    local parts = Workspace:GetPartBoundsInBox(
        CFrame.new(position),
        Vector3.new(4, 6, 4),
        Overlap
    )
    for _, part in ipairs(parts) do
        if IsDangerPart(part) then return true end
    end
    return false
end

local function AmIInDanger()
    if not CachedRoot then return false end
    if IsPositionDangerous(CachedRoot.Position) then
        STATS.DangersDetected = STATS.DangersDetected + 1
        return true
    end
    return false
end

local function FindSafeSpotSmartly(targetPos)
    if not CachedRoot then return targetPos end
    STATS.EvasionAttempts = STATS.EvasionAttempts + 1
    
    local currentPos = CachedRoot.Position
    local currentDist = (currentPos - targetPos).Magnitude
    
    if currentDist <= CFG.AttackDist + 2 and not IsPositionDangerous(currentPos) then
        return currentPos
    end
    
    local angleStep = 360 / CFG.AngleCheckCount
    local bestSpot = nil
    local bestScore = -1
    
    for i = 0, CFG.AngleCheckCount - 1 do
        local angle = math.rad(i * angleStep)
        local checkPos = targetPos + Vector3.new(
            math.cos(angle) * CFG.SafeSpotRadius,
            0,
            math.sin(angle) * CFG.SafeSpotRadius
        )
        
        if not IsPositionDangerous(checkPos) then
            local distToTarget = (checkPos - targetPos).Magnitude
            local score = 100 - distToTarget
            if score > bestScore then
                bestScore = score
                bestSpot = checkPos
            end
        end
    end
    
    if bestSpot then
        STATS.SafeSpotsFound = STATS.SafeSpotsFound + 1
        return bestSpot
    end
    
    if CFG.EscapeAsLastResort then
        STATS.VerticalEscapes = STATS.VerticalEscapes + 1
        return targetPos + Vector3.new(0, CFG.VerticalEscapeHeight, 0)
    else
        return currentPos
    end
end

-------------------------------------------------------------------------
-- NOCLIP SYSTEM
-------------------------------------------------------------------------
local noclipCon = nil

local function EnableNoclip()
    if noclipCon then return end
    noclipCon = RunService.Stepped:Connect(function()
        if STATE.AutoFarmEnabled and CachedChar then
            for _, part in ipairs(CachedChar:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = false
                end
            end
        end
    end)
    print("‚úÖ Noclip Enabled")
end

local function DisableNoclip()
    if noclipCon then
        noclipCon:Disconnect()
        noclipCon = nil
        print("‚ùå Noclip Disabled")
    end
    if CachedChar then
        for _, part in ipairs(CachedChar:GetDescendants()) do
            if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                part.CanCollide = true
            end
        end
    end
end

-------------------------------------------------------------------------
-- AUTO DUNGEON SYSTEM
-------------------------------------------------------------------------
local function GetPlayNewGui()
    return lplr:WaitForChild("PlayerGui"):WaitForChild("PlayNew", 5)
end

local function ScrollAndClick(targetBtn)
    if not targetBtn then return end
    local scrollFrame = targetBtn:FindFirstAncestorOfClass("ScrollingFrame")
    if scrollFrame then
        local btnY = targetBtn.AbsolutePosition.Y
        local scrollY = scrollFrame.AbsolutePosition.Y
        local scrollH = scrollFrame.AbsoluteSize.Y
        local currentCanvasY = scrollFrame.CanvasPosition.Y
        local relativePos = (btnY - scrollY) + currentCanvasY
        local centerPos = relativePos - (scrollH * 0.5) + (targetBtn.AbsoluteSize.Y * 0.5)
        scrollFrame.CanvasPosition = Vector2.new(0, math.max(0, centerPos))
        task.wait(0.4)
    end
    ClickButton(targetBtn)
end

local function WaitForVisible(element, timeout)
    local start = tick()
    timeout = timeout or 5
    while not element.Visible and (tick() - start) < timeout do
        task.wait(0.1)
    end
    return element.Visible
end

local dungeonThread = nil
local function RunAutoDungeonLoop()
    while STATE.AutoDungeonEnabled do
        pcall(function()
            print("üöÄ Starting Dungeon Cycle...")
            local PlayNew = GetPlayNewGui()
            if not PlayNew then return end

            local SelectOption = PlayNew:WaitForChild("SelectOption", 5)
            if SelectOption then
                local StartBtn = SelectOption:FindFirstChild("StartButton")
                if StartBtn then
                    StartBtn = StartBtn:FindFirstChild("TextButton")
                    if StartBtn then 
                        ClickButton(StartBtn)
                        print("‚úÖ Clicked Start Button")
                    end
                end
            end

            task.wait(0.5)

            local Gamemode = PlayNew:WaitForChild("Gamemode", 5)
            if Gamemode and WaitForVisible(Gamemode, 5) then
                task.wait(0.3)
                local container = Gamemode:FindFirstChild("Container")
                if container then
                    local scrollFrame = container:FindFirstChild("ScrollingFrame")
                    if scrollFrame then
                        local modeBtn = nil
                        if STATE.SelectedDungeon == "Normal Dungeon" then
                            local d = scrollFrame:FindFirstChild("Dungeons")
                            modeBtn = d and d:FindFirstChild("TextButton")
                        elseif STATE.SelectedDungeon == "Raid Dungeon" then
                            local r = scrollFrame:FindFirstChild("ElementalRaids")
                            modeBtn = r and r:FindFirstChild("TextButton")
                        elseif STATE.SelectedDungeon == "Infinite Tower" then
                            local t = scrollFrame:FindFirstChild("InfiniteTower")
                            modeBtn = t and t:FindFirstChild("TextButton")
                        end
                        if modeBtn then 
                            ScrollAndClick(modeBtn)
                            print("‚úÖ Selected:", STATE.SelectedDungeon)
                        end
                    end
                end
            end

            task.wait(0.5)

            if STATE.SelectedDungeon == "Normal Dungeon" and STATE.SelectedMap ~= "" then
                local MapPage = PlayNew:FindFirstChild("Main") or PlayNew:FindFirstChild("MainView")
                if MapPage and WaitForVisible(MapPage, 5) then
                    task.wait(0.5)
                    local container = MapPage:FindFirstChild("Container")
                    if container then
                        local scrollFrame = container:FindFirstChild("ScrollingFrame")
                        if scrollFrame then
                            local mapFrame = scrollFrame:FindFirstChild(STATE.SelectedMap)
                            if mapFrame then
                                local btn = mapFrame:FindFirstChild("TextButton")
                                if btn then 
                                    ScrollAndClick(btn)
                                    print("‚úÖ Selected Map:", STATE.SelectedMap)
                                end
                            end
                        end
                    end
                end
            end

            task.wait(0.5)

            local Settings = PlayNew:WaitForChild("DungeonSettings", 8)
            if Settings and WaitForVisible(Settings, 5) then
                local left = Settings:FindFirstChild("Left")
                if left then
                    local playSolo = left:FindFirstChild("PlaySolo")
                    if playSolo then
                        local btn = playSolo:FindFirstChild("TextButton")
                        if btn then
                            ClickButton(btn)
                            print("‚úÖ Entering Dungeon...")
                        end
                    end
                end
            end
        end)
        task.wait(10)
    end
end

-------------------------------------------------------------------------
-- AUTO RETRY SYSTEM
-------------------------------------------------------------------------
local lastRetryClick = 0
local retryThread = nil

local function RunAutoRetry()
    while STATE.AutoRetryEnabled do
        local now = tick()
        if now - lastRetryClick >= CFG.RetryInterval then
            pcall(function()
                local gui = lplr.PlayerGui:FindFirstChild("CompletionScreen")
                if gui then
                    local btn = gui:FindFirstChild("CompletionBorder")
                    if btn then btn = btn:FindFirstChild("CompletionMain") end
                    if btn then btn = btn:FindFirstChild("Retry") end
                    if btn then btn = btn:FindFirstChild("TextButton") end
                    if btn and btn.Visible then
                        if firesignal then
                            firesignal(btn.MouseButton1Click)
                            print("‚úÖ Retry clicked!")
                        end
                        lastRetryClick = now
                    end
                end
            end)
        end
        task.wait(0.2)
    end
end

-------------------------------------------------------------------------
-- AUTO FARM SYSTEM
-------------------------------------------------------------------------
local CurrentTarget = nil
local lastStartClick = 0
local lastSwing = 0
local lastQ, lastE, lastR = 0, 0, 0
local SWING_COOLDOWN = 0.1

local function GetTarget()
    UpdateEnemyCache()
    if #EnemyCache == 0 then return nil end
    if not CachedRoot then return nil end
    
    local myPos = CachedRoot.Position
    local nearest = nil
    local minDist = CFG.SearchRange
    
    for _, data in ipairs(EnemyCache) do
        if data.Enemy and data.Enemy.Parent and data.Root and data.Root.Parent then
            local dist = (data.Position - myPos).Magnitude
            if dist < minDist then
                minDist = dist
                nearest = data.Enemy
            end
        end
    end
    return nearest
end

local farmCon = nil
local lastUpdate = 0
local UPDATE_RATE = 0.1

local function StartAutoFarm()
    if farmCon then
        farmCon:Disconnect()
        farmCon = nil
    end
    
    RemoveBodyMovers()
    
    if not UpdateCharacterCache() then
        warn("‚ö†Ô∏è Character not found, waiting...")
        task.wait(2)
        UpdateCharacterCache()
    end
    
    if not CachedRoot then
        warn("‚ùå No HumanoidRootPart found!")
        return
    end
    
    CreateBodyMovers()
    print("üü¢ Auto Farm STARTED")
    STATS.FarmActive = true
    
    farmCon = RunService.Heartbeat:Connect(function(dt)
        if not STATE.AutoFarmEnabled then return end
        
        local now = tick()
        if now - lastUpdate < UPDATE_RATE then return end
        lastUpdate = now

        if not CachedChar or not CachedChar.Parent or not CachedRoot or not CachedRoot.Parent then
            if UpdateCharacterCache() and CachedRoot then
                CreateBodyMovers()
            else
                return
            end
        end
        
        if not CachedHum or CachedHum.Health <= 0 then return end

        if now - lastStartClick >= 8 then
            pcall(function()
                local mainGui = lplr.PlayerGui:FindFirstChild("mainGui")
                if mainGui then
                    local startBtn = mainGui:FindFirstChild("startDungeon")
                    if startBtn then
                        startBtn = startBtn:FindFirstChild("TextButton")
                        if startBtn and startBtn.Visible and firesignal then
                            firesignal(startBtn.MouseButton1Click)
                        end
                    end
                end
            end)
            lastStartClick = now
        end

        if not CurrentTarget or not CurrentTarget.Parent then
            CurrentTarget = GetTarget()
        else
            local tHum = CurrentTarget:FindFirstChild("Humanoid")
            if not tHum or tHum.Health <= 0 then
                CurrentTarget = GetTarget()
            end
        end

        if CurrentTarget then
            local tRoot = CurrentTarget:FindFirstChild("HumanoidRootPart")
            if tRoot and tRoot.Parent then
                local tPos = tRoot.Position
                local myPos = CachedRoot.Position
                local distance = (tPos - myPos).Magnitude
                
                STATS.LastTarget = CurrentTarget.Name
                STATS.Status = "Fighting: " .. CurrentTarget.Name
                
                local inDanger = AmIInDanger()
                local targetSpot = nil
                
                if inDanger then
                    targetSpot = FindSafeSpotSmartly(tPos)
                else
                    if distance > CFG.AttackDist then
                        targetSpot = FindSafeSpotSmartly(tPos)
                    else
                        targetSpot = myPos
                    end
                end
                
                local speed = inDanger and CFG.PanicSpeed or CFG.MoveSpeed
                
                if BodyVel then
                    if (targetSpot - myPos).Magnitude > 2 then
                        local direction = (targetSpot - myPos).Unit
                        BodyVel.Velocity = direction * speed
                    else
                        BodyVel.Velocity = Vector3.zero
                    end
                end
                
                if BodyGyro then
                    local lookPos = Vector3.new(tPos.X, myPos.Y, tPos.Z)
                    BodyGyro.CFrame = CFrame.new(myPos, lookPos)
                end
                
                if distance <= CFG.AttackDist + 5 and now - lastSwing >= SWING_COOLDOWN then
                    AttemptAttack()
                    STATS.AttacksFired = STATS.AttacksFired + 1
                    lastSwing = now
                end
                
                if STATE.AutoSkillsEnabled and distance <= CFG.AttackDist + 5 then
                    if now - lastQ >= CFG.SkillCooldown then 
                        PressKey(Enum.KeyCode.Q) 
                        lastQ = now 
                    end
                    if now - lastE >= CFG.SkillCooldown + 0.5 then 
                        PressKey(Enum.KeyCode.E) 
                        lastE = now 
                    end
                    if now - lastR >= CFG.SkillCooldown + 1.0 then 
                        PressKey(Enum.KeyCode.R) 
                        lastR = now 
                    end
                end
            else
                CurrentTarget = nil
            end
        else
            if BodyVel then
                BodyVel.Velocity = Vector3.zero
            end
            STATS.LastTarget = "None"
            STATS.Status = "Searching..."
        end
    end)
end

local function StopAutoFarm()
    print("üî¥ Auto Farm STOPPING...")
    STATS.FarmActive = false
    
    if farmCon then
        farmCon:Disconnect()
        farmCon = nil
    end
    
    RemoveBodyMovers()
    DisableNoclip()
    CurrentTarget = nil
    STATS.Status = "Idle"
    print("üî¥ Auto Farm STOPPED")
end

-------------------------------------------------------------------------
-- UI SETUP
-------------------------------------------------------------------------
local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()

local Window = WindUI:CreateWindow({
    Title = "Hyper Premium",
    Icon = "rbxassetid://10723415903",
    Author = "Premium",
    Folder = ConfigFolder,
    Size = UDim2.fromOffset(600, 400),
    Transparent = true,
    Theme = "Dark",
    Resizable = true,
})

Window:EditOpenButton({
    Title = "Hyper HUB",
    Icon = "",
    CornerRadius = UDim.new(0,6),
    StrokeThickness = 1,
    Color = ColorSequence.new(
        Color3.fromHex("FF0F7B"), 
        Color3.fromHex("F89B29")
    ),
    Enabled = true,
    Draggable = true,
})

Window:Tag({
    Title = "v1.0.0",
    Icon = "github",
    Color = Color3.fromHex("#30ff6a"),
    Radius = 6,
})

local GeneralTab = Window:Tab({ Title = "General", Icon = "home" })
local ConfigTab = Window:Tab({ Title = "Config", Icon = "save" })
local SettingTab = Window:Tab({ Title = "Setting", Icon = "settings" })
local DebugTab = Window:Tab({ Title = "Debug", Icon = "bug" })

-------------------------------------------------------------------------
-- GENERAL TAB
-------------------------------------------------------------------------
local MainSec = GeneralTab:Section({ Title = "Main Features" })

MainSec:Toggle({ 
    Title = "Auto Dungeon", 
    Desc = "‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤ Dungeon ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥", 
    Flag = "AutoDungeon", 
    Value = false, 
    Callback = function(v) 
        STATE.AutoDungeonEnabled = v 
        if v then
            dungeonThread = task.spawn(RunAutoDungeonLoop)
            Window:Notify({Title = "Auto Dungeon", Content = "üü¢ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß!", Duration = 3})
        else
            if dungeonThread then task.cancel(dungeonThread) dungeonThread = nil end
            Window:Notify({Title = "Auto Dungeon", Content = "üî¥ ‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß", Duration = 3})
        end
    end 
})

MainSec:Toggle({ 
    Title = "Auto Farm", 
    Desc = "‡∏ü‡∏≤‡∏£‡πå‡∏°‡∏®‡∏±‡∏ï‡∏£‡∏π‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (Smart Evasion)", 
    Flag = "AutoFarm", 
    Value = false, 
    Callback = function(v) 
        STATE.AutoFarmEnabled = v
        if v then
            table.clear(EnemyCache)
            table.clear(DangerCache)
            EnableNoclip()
            StartAutoFarm()
            Window:Notify({Title = "Auto Farm", Content = "üü¢ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÅ‡∏•‡πâ‡∏ß!", Duration = 3})
        else
            StopAutoFarm()
            Window:Notify({Title = "Auto Farm", Content = "üî¥ ‡∏´‡∏¢‡∏∏‡∏î‡∏ü‡∏≤‡∏£‡πå‡∏°", Duration = 3})
        end
    end 
})

MainSec:Toggle({ 
    Title = "Auto Skills", 
    Desc = "‡πÉ‡∏ä‡πâ Q/E/R ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥", 
    Flag = "AutoSkills", 
    Value = true, 
    Callback = function(v) STATE.AutoSkillsEnabled = v end 
})

MainSec:Toggle({ 
    Title = "Auto Retry", 
    Desc = "‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° Retry ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥", 
    Flag = "AutoRetry", 
    Value = false, 
    Callback = function(v) 
        STATE.AutoRetryEnabled = v 
        if v then
            retryThread = task.spawn(RunAutoRetry)
            Window:Notify({Title = "Auto Retry", Content = "üü¢ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß!", Duration = 3})
        else
            if retryThread then task.cancel(retryThread) retryThread = nil end
            Window:Notify({Title = "Auto Retry", Content = "üî¥ ‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß", Duration = 3})
        end
    end 
})

local DungeonSec = GeneralTab:Section({ Title = "Dungeon Selection" })

DungeonSec:Dropdown({ 
    Title = "Dungeon Type", 
    Values = {"Normal Dungeon", "Raid Dungeon", "Infinite Tower"}, 
    Default = "Normal Dungeon", 
    Callback = function(v) STATE.SelectedDungeon = v end 
})

local MapDrop = DungeonSec:Dropdown({ 
    Title = "Select Map", 
    Values = {"Refresh First"}, 
    Callback = function(v) STATE.SelectedMap = v end 
})

DungeonSec:Button({ 
    Title = "üîÑ Refresh Maps List", 
    Callback = function() 
        pcall(function()
            local PlayNew = lplr.PlayerGui:FindFirstChild("PlayNew")
            local MapPage = PlayNew and (PlayNew:FindFirstChild("Main") or PlayNew:FindFirstChild("MainView"))
            if MapPage then
                local container = MapPage:FindFirstChild("Container")
                if container then
                    local scrollFrame = container:FindFirstChild("ScrollingFrame")
                    if scrollFrame then
                        local maps = {}
                        for _, v in ipairs(scrollFrame:GetChildren()) do
                            if v:IsA("Frame") and not string.find(v.Name, "UI", 1, true) then
                                table.insert(maps, v.Name)
                            end
                        end
                        table.sort(maps)
                        MapDrop:Refresh(maps, true)
                        Window:Notify({Title = "Maps", Content = "‚úÖ Found " .. #maps .. " maps!", Duration = 3})
                    end
                end
            else
                Window:Notify({Title = "Warning", Content = "‚ö†Ô∏è ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ Map Selection ‡∏Å‡πà‡∏≠‡∏ô!", Duration = 3})
            end
        end)
    end
})

-------------------------------------------------------------------------
-- CONFIG TAB - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏±‡∏ô
-------------------------------------------------------------------------
ConfigTab:Section({ Title = "‚öôÔ∏è Config Presets" })

ConfigTab:Dropdown({ 
    Title = "Load Preset", 
    Desc = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å config ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ",
    Values = {"Default", "Aggressive", "Safe", "Speed"}, 
    Default = "Default", 
    Flag = "ConfigPreset",
    Callback = function(v)
        if LoadConfigPreset(v) then
            Window:Notify({Title = "Config", Content = "‚úÖ Loaded: " .. v, Duration = 3})
        end
    end 
})

ConfigTab:Section({ Title = "üìä Preset Details" })

ConfigTab:Paragraph({ 
    Title = "Default Preset", 
    Desc = "‚öñÔ∏è Balanced - ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏î‡∏µ\n‚Ä¢ Attack: 12 | Speed: 60 | Safe Radius: 12"
})

ConfigTab:Paragraph({ 
    Title = "Aggressive Preset", 
    Desc = "‚öîÔ∏è Fast & Risky - ‡πÄ‡∏£‡πá‡∏ß ‡πÉ‡∏Å‡∏•‡πâ ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á\n‚Ä¢ Attack: 10 | Speed: 80 | Safe Radius: 10"
})

ConfigTab:Paragraph({ 
    Title = "Safe Preset", 
    Desc = "üõ°Ô∏è Maximum Safety - ‡∏ä‡πâ‡∏≤ ‡πÑ‡∏Å‡∏• ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏™‡∏π‡∏á\n‚Ä¢ Attack: 15 | Speed: 50 | Safe Radius: 15"
})

ConfigTab:Paragraph({ 
    Title = "Speed Preset", 
    Desc = "‚ö° Ultra Fast - ‡πÄ‡∏£‡πá‡∏ß‡∏°‡∏≤‡∏Å ‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÄ‡∏£‡πá‡∏ß\n‚Ä¢ Attack: 12 | Speed: 100 | Safe Radius: 12"
})

ConfigTab:Section({ Title = "üíæ Save/Load System" })

local NewConfigName = "AutoSave"
ConfigTab:Input({ 
    Title = "Config Name", 
    Desc = "‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å",
    Default = "AutoSave",
    Flag = "ConfigName",
    Callback = function(v) NewConfigName = v end 
})

ConfigTab:Button({ 
    Title = "üíæ Save Config", 
    Desc = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô",
    Callback = function() 
        if SaveConfig(NewConfigName) then
            Window:Notify({Title = "Saved", Content = "‚úÖ " .. NewConfigName, Duration = 2}) 
        end
    end 
})

local CFGDrop = ConfigTab:Dropdown({ 
    Title = "Select Config", 
    Desc = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÇ‡∏´‡∏•‡∏î",
    Values = GetConfigList(), 
    Default = "AutoSave",
    Flag = "LoadConfigFile",
    Callback = function(v) NewConfigName = v end 
})

ConfigTab:Button({ 
    Title = "üìÇ Load Config", 
    Desc = "‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ",
    Callback = function() 
        if LoadConfig(NewConfigName) then 
            Window:Notify({Title = "Loaded", Content = "‚úÖ " .. NewConfigName, Duration = 2}) 
        end 
    end 
})

ConfigTab:Button({ 
    Title = "üîÑ Refresh List", 
    Desc = "‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå",
    Callback = function() 
        local files = GetConfigList()
        CFGDrop:Refresh(files, true)
        Window:Notify({Title = "Refresh", Content = "‚úÖ Found " .. #files .. " configs", Duration = 2})
    end 
})

ConfigTab:Section({ Title = "‚öôÔ∏è Auto Features" })

ConfigTab:Toggle({ 
    Title = "Auto Load Config", 
    Desc = "‡πÇ‡∏´‡∏•‡∏î AutoSave ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå", 
    Flag = "AutoLoadConfig", 
    Value = false, 
    Callback = function(v) STATE.AutoLoadConfig = v end 
})

ConfigTab:Toggle({ 
    Title = "Auto Save (10s)", 
    Desc = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ",
    Flag = "AutoSave",
    Value = false, 
    Callback = function(v) STATE.AutoSaveEnabled = v end 
})

ConfigTab:Section({ Title = "üìà Current Settings" })

ConfigTab:Paragraph({
    Title = "Active Config",
    Desc = "Config: " .. STATE.CurrentConfigName .. "\nAttack: " .. CFG.AttackDist .. " | Speed: " .. CFG.MoveSpeed
})

-------------------------------------------------------------------------
-- SETTING TAB
-------------------------------------------------------------------------
SettingTab:Section({ Title = "‚öîÔ∏è Combat Settings" })

SettingTab:Slider({ 
    Title = "Attack Distance", 
    Desc = "‡∏£‡∏∞‡∏¢‡∏∞‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡∏®‡∏±‡∏ï‡∏£‡∏π",
    Flag = "AttackDist",
    Step = 1,
    Value = {Min = 6, Max = 25, Default = CFG.AttackDist},
    Callback = function(v) CFG.AttackDist = v end 
})

SettingTab:Slider({ 
    Title = "Move Speed", 
    Desc = "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà",
    Flag = "MoveSpeed",
    Step = 5,
    Value = {Min = 30, Max = 150, Default = CFG.MoveSpeed},
    Callback = function(v) CFG.MoveSpeed = v end 
})

SettingTab:Slider({ 
    Title = "Panic Speed", 
    Desc = "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢",
    Flag = "PanicSpeed",
    Step = 5,
    Value = {Min = 50, Max = 200, Default = CFG.PanicSpeed},
    Callback = function(v) CFG.PanicSpeed = v end 
})

SettingTab:Slider({ 
    Title = "Search Range", 
    Desc = "‡∏£‡∏∞‡∏¢‡∏∞‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏®‡∏±‡∏ï‡∏£‡∏π",
    Flag = "SearchRange",
    Step = 50,
    Value = {Min = 500, Max = 3000, Default = CFG.SearchRange},
    Callback = function(v) CFG.SearchRange = v end 
})

SettingTab:Slider({ 
    Title = "Skill Cooldown", 
    Desc = "‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≠‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏Å‡∏¥‡∏•",
    Flag = "SkillCooldown",
    Step = 0.1,
    Value = {Min = 0.5, Max = 3, Default = CFG.SkillCooldown},
    Callback = function(v) CFG.SkillCooldown = v end 
})

SettingTab:Section({ Title = "üõ°Ô∏è Evasion Settings" })

SettingTab:Slider({ 
    Title = "Safe Spot Radius", 
    Desc = "‡∏£‡∏±‡∏®‡∏°‡∏µ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏à‡∏∏‡∏î‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢",
    Flag = "SafeSpotRadius",
    Step = 1,
    Value = {Min = 8, Max = 20, Default = CFG.SafeSpotRadius},
    Callback = function(v) CFG.SafeSpotRadius = v end 
})

SettingTab:Slider({ 
    Title = "Angle Check Count", 
    Desc = "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏∏‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πá‡∏Ñ",
    Flag = "AngleCheckCount",
    Step = 2,
    Value = {Min = 4, Max = 16, Default = CFG.AngleCheckCount},
    Callback = function(v) CFG.AngleCheckCount = v end 
})

SettingTab:Slider({ 
    Title = "Vertical Escape Height", 
    Desc = "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏ö",
    Flag = "VerticalEscape",
    Step = 5,
    Value = {Min = 20, Max = 100, Default = CFG.VerticalEscapeHeight},
    Callback = function(v) CFG.VerticalEscapeHeight = v end 
})

SettingTab:Toggle({ 
    Title = "Escape as Last Resort", 
    Desc = "‡∏´‡∏•‡∏ö‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏à‡∏∏‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠",
    Flag = "EscapeLastResort", 
    Value = true, 
    Callback = function(v) CFG.EscapeAsLastResort = v end 
})

SettingTab:Section({ Title = "üîß Other Settings" })

SettingTab:Slider({ 
    Title = "Retry Interval", 
    Desc = "‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏î Retry",
    Flag = "RetryInterval",
    Step = 0.1,
    Value = {Min = 0.3, Max = 3, Default = CFG.RetryInterval},
    Callback = function(v) CFG.RetryInterval = v end 
})

SettingTab:Button({ 
    Title = "üóëÔ∏è Clear Cache", 
    Desc = "‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏Ñ‡∏ä‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",
    Callback = function()
        table.clear(EnemyCache)
        table.clear(DangerCache)
        Window:Notify({Title = "Cache", Content = "‚úÖ ‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏Ñ‡∏ä‡πÅ‡∏•‡πâ‡∏ß!", Duration = 3})
    end 
})

-------------------------------------------------------------------------
-- DEBUG TAB
-------------------------------------------------------------------------
DebugTab:Section({ Title = "üìä Live Statistics" })

local StatsText = "Loading..."
local StatsLabel = DebugTab:Paragraph({
    Title = "Real-time Stats",
    Desc = StatsText,
})

-- Update Stats
task.spawn(function()
    while task.wait(1) do
        pcall(function()
            local status = STATS.FarmActive and "üü¢ ACTIVE" or "üî¥ IDLE"
            local newText = string.format(
                "%s | %s | %s\n" ..
                "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n" ..
                "üëæ Enemies: %d | ‚öîÔ∏è Attacks: %d\n" ..
                "‚ö†Ô∏è Dangers: %d | üèÉ Evasions: %d\n" ..
                "‚úÖ Safe Spots: %d | ‚¨ÜÔ∏è Escapes: %d\n" ..
                "üîÑ Respawns: %d\n" ..
                "üéØ Target: %s",
                status,
                STATE.CurrentConfigName,
                STATS.Status,
                STATS.EnemiesFound,
                STATS.AttacksFired,
                STATS.DangersDetected,
                STATS.EvasionAttempts,
                STATS.SafeSpotsFound,
                STATS.VerticalEscapes,
                STATS.Respawns,
                STATS.LastTarget
            )
            
            if StatsText ~= newText then
                StatsText = newText
                -- Try to update if method exists
                pcall(function()
                    if StatsLabel.Set then
                        StatsLabel:Set({ Desc = newText })
                    end
                end)
            end
        end)
    end
end)

DebugTab:Section({ Title = "üî¨ Testing Tools" })

DebugTab:Button({ 
    Title = "üîç Test Enemy Detection", 
    Desc = "‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏≤‡∏®‡∏±‡∏ï‡∏£‡∏π",
    Callback = function()
        UpdateEnemyCache()
        Window:Notify({Title = "Debug", Content = "Found " .. #EnemyCache .. " enemies!", Duration = 3})
    end 
})

DebugTab:Button({ 
    Title = "‚ö†Ô∏è Test Danger Detection", 
    Desc = "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢",
    Callback = function()
        local inDanger = AmIInDanger()
        Window:Notify({Title = "Debug", Content = inDanger and "‚ö†Ô∏è IN DANGER!" or "‚úÖ Safe", Duration = 3})
    end 
})

DebugTab:Button({ 
    Title = "üîÑ Reset Stats", 
    Desc = "‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥",
    Callback = function()
        STATS.AttacksFired = 0
        STATS.DangersDetected = 0
        STATS.EvasionAttempts = 0
        STATS.SafeSpotsFound = 0
        STATS.VerticalEscapes = 0
        Window:Notify({Title = "Debug", Content = "‚úÖ Stats Reset!", Duration = 3})
    end 
})

DebugTab:Button({ 
    Title = "üîÑ Force Refresh Character", 
    Desc = "‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£",
    Callback = function()
        UpdateCharacterCache()
        Window:Notify({Title = "Debug", Content = "‚úÖ Character Refreshed!", Duration = 3})
    end 
})

DebugTab:Button({ 
    Title = "üõë Emergency Stop All", 
    Desc = "‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ",
    Callback = function()
        StopAutoFarm()
        STATE.AutoDungeonEnabled = false
        STATE.AutoRetryEnabled = false
        STATE.AutoFarmEnabled = false
        Window:Notify({Title = "Debug", Content = "üõë All Stopped!", Duration = 3})
    end 
})

-------------------------------------------------------------------------
-- AUTO SAVE LOOP
-------------------------------------------------------------------------
task.spawn(function()
    local timer = 0
    while task.wait(1) do
        if STATE.AutoSaveEnabled then
            timer = timer + 1
            if timer >= 10 then
                SaveConfig("AutoSave")
                timer = 0
            end
        end
    end
end)

-------------------------------------------------------------------------
-- AUTO LOAD STARTUP
-------------------------------------------------------------------------
task.spawn(function()
    task.wait(1.5)
    local path = ConfigFolder .. "/AutoSave.json"
    if isfile(path) then
        local content = readfile(path)
        local s, d = pcall(function() return HttpService:JSONDecode(content) end)
        if s and d and d.AutoLoadConfig then
            LoadConfig("AutoSave")
            Window:Notify({Title="AutoLoad", Content="‚úÖ Config Loaded", Duration=3})
        end
    end
end)

Window:SelectTab(GeneralTab)
-------------------------------------------------------------------------
-- EXTENSION: MISC & UTILITY (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏™‡∏£‡∏¥‡∏°)
-------------------------------------------------------------------------
local MiscTab = Window:Tab({ Title = "Misc", Icon = "wrench" })
local UtilitySec = MiscTab:Section({ Title = "üõ†Ô∏è Utilities" })

-- 1. Anti-AFK System (‡∏Å‡∏±‡∏ô‡∏´‡∏•‡∏∏‡∏î)
local VirtualUser = game:GetService("VirtualUser")
STATE.AntiAFKEnabled = true -- Default True

UtilitySec:Toggle({
    Title = "Anti-AFK",
    Desc = "‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏∞‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå (20 ‡∏ô‡∏≤‡∏ó‡∏µ)",
    Flag = "AntiAFK",
    Value = true,
    Callback = function(v) 
        STATE.AntiAFKEnabled = v 
    end
})

lplr.Idled:Connect(function()
    if STATE.AntiAFKEnabled then
        VirtualUser:CaptureController()
        VirtualUser:ClickButton2(Vector2.new())
        print("üö´ Anti-AFK: Prevented Kick")
    end
end)

-- 2. Auto Loot System (‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≠‡∏á/‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏µ‡∏ö)
STATE.AutoLootEnabled = false

UtilitySec:Toggle({
    Title = "Auto Loot / Interact",
    Desc = "‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° E (ProximityPrompt) ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡∏µ‡∏ö‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥)",
    Flag = "AutoLoot",
    Value = false,
    Callback = function(v)
        STATE.AutoLootEnabled = v
        if v then
            task.spawn(function()
                while STATE.AutoLootEnabled do
                    pcall(function()
                        -- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Prompt ‡πÉ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡πÉ‡∏Å‡∏•‡πâ
                        if CachedRoot then
                            for _, prompt in ipairs(Workspace:GetDescendants()) do
                                if prompt:IsA("ProximityPrompt") and prompt.Enabled then
                                    local part = prompt.Parent
                                    if part and part:IsA("BasePart") then
                                        local dist = (CachedRoot.Position - part.Position).Magnitude
                                        if dist <= prompt.MaxActivationDistance + 5 then
                                            fireproximityprompt(prompt)
                                        end
                                    end
                                end
                            end
                        end
                    end)
                    task.wait(0.5)
                end
            end)
            Window:Notify({Title = "Auto Loot", Content = "üü¢ Enabled", Duration = 3})
        end
    end
})

-- 3. FPS Boost (‡∏•‡∏î‡πÅ‡∏•‡∏Ñ)
UtilitySec:Button({
    Title = "üöÄ FPS Boost",
    Desc = "‡∏•‡∏ö Texture ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Ñ",
    Callback = function()
        pcall(function()
            local decals = 0
            for _, v in pairs(Workspace:GetDescendants()) do
                if v:IsA("Decal") or v:IsA("Texture") then
                    v:Destroy()
                    decals = decals + 1
                end
            end
            Window:Notify({Title = "FPS Boost", Content = "üóëÔ∏è Deleted " .. decals .. " textures", Duration = 3})
        end)
    end
})

-- 4. Server Hop (‡∏¢‡πâ‡∏≤‡∏¢‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü)
UtilitySec:Button({
    Title = "üåé Server Hop",
    Desc = "‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏≠‡∏∑‡πà‡∏ô (‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡∏ô‡πâ‡∏≠‡∏¢)",
    Callback = function()
        Window:Notify({Title = "Server Hop", Content = "‚è≥ Searching for server...", Duration = 3})
        task.spawn(function()
            local PlaceID = game.PlaceId
            local AllIDs = {}
            local found = false
            local function Teleport()
                while task.wait(0.1) do
                    pcall(function()
                        local servers = HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/"..PlaceID.."/servers/Public?sortOrder=Asc&limit=100")).data
                        for i,v in pairs(servers) do
                            if v.playing < v.maxPlayers - 1 and v.id ~= game.JobId then
                                AllIDs[#AllIDs+1] = v.id
                            end
                        end
                    end)
                    if #AllIDs > 0 then
                        game:GetService("TeleportService"):TeleportToPlaceInstance(PlaceID, AllIDs[math.random(1, #AllIDs)], lplr)
                        found = true
                    end
                    if found then break end
                end
            end
            Teleport()
        end)
    end
})

-- 5. White Screen (‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î GPU)
UtilitySec:Toggle({
    Title = "White Screen",
    Desc = "‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏Ç‡∏≤‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á",
    Value = false,
    Callback = function(v)
        if v then
            RunService:Set3dRenderingEnabled(false)
        else
            RunService:Set3dRenderingEnabled(true)
        end
    end
})

-------------------------------------------------------------------------
-- END OF SCRIPT & NOTIFICATION
-------------------------------------------------------------------------
-- ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
task.delay(1, function()
    Window:Notify({
        Title = "Hyper Premium", 
        Content = "‚úÖ Loaded Extension (Misc & Utility)", 
        Duration = 5
    })
end)
